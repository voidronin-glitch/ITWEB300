<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AJAX Ticket Viewer (with Load Function)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { padding: 8px; margin: 5px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
  </style>
</head>
<body>
  <h1>Employee Ticket Lookup</h1>
  <input type="text" id="empInput" placeholder="Enter Employee ID">
  <button id="getBtn">Get Tickets</button>

  <table id="ticketTable"></table>

  <!-- Embed XML directly -->
  <script id="ticketsData" type="text/xml">
    <tickets>
      <ticket>
        <requestDate>2025-09-02</requestDate>
        <employeeID>123</employeeID>
        <firstName>John</firstName>
        <lastName>Doe</lastName>
        <problem>Computer not starting</problem>
        <status>Open</status>
        <response>Pending support team review</response>
      </ticket>
      <ticket>
        <requestDate>2025-08-30</requestDate>
        <employeeID>456</employeeID>
        <firstName>Jane</firstName>
        <lastName>Smith</lastName>
        <problem>Forgot password</problem>
        <status>Closed</status>
        <response>Password reset link sent</response>
      </ticket>
      <ticket>
        <requestDate>2025-08-28</requestDate>
        <employeeID>123</employeeID>
        <firstName>John</firstName>
        <lastName>Doe</lastName>
        <problem>Email not syncing</problem>
        <status>In Progress</status>
        <response>Technician assigned</response>
      </ticket>
    </tickets>
  </script>

  <script>
    // Run this once the page is loaded
    window.onload = function () {
      document.getElementById("getBtn").addEventListener("click", function () {
        var employeeId = document.getElementById("empInput").value;
        getTickets(employeeId);
      });
    };

    function getTickets(employeeId) {
      if (!employeeId) {
        alert("Please enter a valid employee ID.");
        return;
      }

      // Grab embedded XML text
      var xmlString = document.getElementById("ticketsData").textContent.trim();

      // Parse XML string into DOM
      var parser = new DOMParser();
      var xmlDoc = parser.parseFromString(xmlString, "text/xml");
      var tickets = xmlDoc.getElementsByTagName("ticket");

      var table = document.getElementById("ticketTable");
      table.innerHTML = "";

      // Table header
      var header = `<tr>
        <th>Request Date</th>
        <th>Employee ID</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Problem</th>
        <th>Status</th>
        <th>Response</th>
      </tr>`;
      table.innerHTML += header;

      var found = false;

      for (var i = 0; i < tickets.length; i++) {
        var empId = tickets[i].getElementsByTagName("employeeID")[0].textContent;

        if (empId.trim() === employeeId.trim()) {
          found = true;
          var date = tickets[i].getElementsByTagName("requestDate")[0].textContent;
          var fname = tickets[i].getElementsByTagName("firstName")[0].textContent;
          var lname = tickets[i].getElementsByTagName("lastName")[0].textContent;
          var problem = tickets[i].getElementsByTagName("problem")[0].textContent;
          var status = tickets[i].getElementsByTagName("status")[0].textContent;
          var response = tickets[i].getElementsByTagName("response")[0].textContent;

          var row = `<tr>
            <td>${date}</td>
            <td>${empId}</td>
            <td>${fname}</td>
            <td>${lname}</td>
            <td>${problem}</td>
            <td>${status}</td>
            <td>${response}</td>
          </tr>`;
          table.innerHTML += row;
        }
      }

      if (!found) {
        table.innerHTML += `<tr><td colspan="7">No tickets found for Employee ID: ${employeeId}</td></tr>`;
      }
    }
  </script>
</body>
</html>
